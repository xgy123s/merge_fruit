System.register("chunks:///_virtual/gamePanel",["./gamePanel.ts"],(function(){return{setters:[null],execute:function(){}}}));

System.register("chunks:///_virtual/gamePanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./panelBasic.ts","./GameGlobal.ts","./AudioManage.ts","./TimeUtil.ts","./StorageUtil.ts","./ActionUtil.ts","./StaticLayer.ts","./FruitCollision.ts","./GameLogic.ts","./GameConfig.ts","./RandomPropLayer.ts","./ConfirmExitLayer.ts","./GetMaxAwardLayer.ts","./SkillLayer.ts","./EventUtil.ts","./BundleLayer.ts"],(function(t){var e,i,r,n,a,o,s,l,u,h,c,g,p,f,d,m,y,F,w,b,C,N,P,L,v,S,T,H,I,G,k,z,_,A,B,O,x,E,U;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){r=t.cclegacy,n=t.Node,a=t.Prefab,o=t.SpriteAtlas,s=t.SpriteFrame,l=t.Animation,u=t._decorator,h=t.PhysicsSystem2D,c=t.v3,g=t.UITransform,p=t.tween,f=t.UIOpacity,d=t.easing,m=t.instantiate,y=t.Sprite,F=t.RigidBody2D,w=t.v2,b=t.CircleCollider2D,C=t.Tween,N=t.Label},function(t){P=t.default},function(t){L=t.GameGlobal},function(t){v=t.AudioManage,S=t.SoundList},function(t){T=t.TimeUtil},function(t){H=t.default},function(t){I=t.default},function(t){G=t.default},function(t){k=t.default},function(t){z=t.GameLogic},function(t){_=t.default},function(t){A=t.default},function(t){B=t.default},function(t){O=t.GetMaxAwardLayer},function(t){x=t.default},function(t){E=t.default},function(t){U=t.default}],execute:function(){var D,M,R,W,Q,$,j,J,V,X,q,K,Y,Z,tt,et,it,rt,nt,at,ot,st,lt,ut,ht,ct,gt,pt,ft,dt,mt,yt,Ft,wt,bt,Ct,Nt,Pt;r._RF.push({},"7577atUmDxL940yQ7TJPuQ1","gamePanel",void 0);const{ccclass:Lt,property:vt}=u;t("gamePanel",(D=vt(B),M=vt(A),R=vt(O),W=vt(x),Q=vt(n),$=vt(n),j=vt(n),J=vt(n),V=vt(n),X=vt(a),q=vt(n),K=vt(o),Y=vt(s),Z=vt(n),tt=vt(l),et=vt(n),it=vt(n),rt=vt(n),Lt((ot=e((at=class extends P{constructor(){super(...arguments),i(this,"ConfirmExitLayer",ot,this),i(this,"RandomPropLayer",st,this),i(this,"GetMaxAwardLayer",lt,this),i(this,"skillLayer",ut,this),i(this,"targetLayer",ht,this),i(this,"targetParent",ct,this),i(this,"gameBg",gt,this),i(this,"fruitNode",pt,this),i(this,"targetfruitNode",ft,this),i(this,"fruitPre",dt,this),i(this,"lineNode",mt,this),i(this,"picAtlas",yt,this),i(this,"powerBallFrame",Ft,this),i(this,"floor",wt,this),i(this,"guanghuan",bt,this),i(this,"effectParent",Ct,this),i(this,"airdropParent",Nt,this),i(this,"difficultNode",Pt,this),this.targetFruit=null,this.isClearState=!1,this.isGameOver=!1,this.allFruitsHeigth={},this.fruitHeigth=0,this._showWarningLineN=0,this._targetFruitLevel=1,this._isNewPlayer=!0,this.endOne=0}get showNode(){return this.main}onLoad(){h.instance.enable=!0,G.Instance.setGameStatic(this),G.Instance.setSkillStatic(this.skillLayer),G.Instance.setConfirmExitStatic(this.ConfirmExitLayer),this.skillLayer.node.active=!1,this.isClearState=!1,this.isGameOver=!1}onEnable(){E.on("reviveGame",(()=>{this.isGameOver=!1,this.fruitNode.removeAllChildren(),this.targetfruitNode.removeAllChildren(),this.createOneFruit(0,c(0,500))})),this.scheduleOnce((()=>{L.instance.airdropParent=this.airdropParent}),.1)}onDisable(){L.instance.airdropParent=void 0,E.targetOff(this)}start(){this.playWarningLineAnim(),this.createOneFruit(0,c(0,500)),this.initShowTargetFruit(),this.initShowNewPlayerProp(),this.schedule(this.findHighestFruit,.1),this._showWarningLineN=0}get _floorHeight(){return this.floor.position.y+this.floor.getComponent(g).height/2}playWarningLineAnim(){p(this.lineNode.children[0].getComponent(f)).to(.3,{opacity:255},{easing:d.backOut}).to(.3,{opacity:0},{easing:d.backOut}).union().repeatForever().start(),this.lineNode.children[0].active=!1}createOneFruit(t,e){let i=m(this.fruitPre);i.setParent(this.targetfruitNode);let r=t;const n=_.getFruitInfo(r);let a=this.picAtlas.getSpriteFrame(n.spriteName);i.getComponent(y).spriteFrame=a;let o=n.size;i.getComponent(g).setContentSize(o),i.getComponent(k).fruitNumber=t,i.setPosition(e),i.setScale(0,0),i.getComponent(F).enabled=!1,i.active=!0,this.targetFruit=i,p(i).to(.3,{scale:c(1,1,1)},{easing:"backOut"}).call((()=>{z.instance.updateTopFruitLevel(r),z.instance.addFruitCount()})).start()}createLevelUpFruit(t,e){if(v.playSFX(S.swap),t>_.maxFriutId)return;let i=m(this.fruitPre);i.parent=this.fruitNode;let r=t;const n=_.getFruitInfo(r);let a=this.picAtlas.getSpriteFrame(n.spriteName);i.getComponent(y).spriteFrame=a;let o=n.size;i.getComponent(g).setContentSize(o),i.getComponent(k).fruitNumber=t,i.setPosition(e),i.setScale(0,0),i.getComponent(F).linearVelocity=w(0,-10),i.getComponent(b).radius=i.getComponent(g).height/2,i.getComponent(b).apply(),p(i).to(.5,{scale:c(1,1,1)},{easing:"backOut"}).call((()=>{z.instance.updateTopFruitLevel(r),z.instance.addFruitCount(),null!=i.getComponent(b)&&(i.getComponent(b).radius=i.getComponent(g).height/2,i.getComponent(b).apply(),i.getComponent(F).enabled=!0),this.checkFinishShowTargetFruit(r),r==_.maxFriutId&&(z.instance.composeBigWatermelonCount++,z.instance.addScore(100),this.GetMaxAwardLayer.show())})).start()}findHighestFruit(){const t=this._floorHeight,e={};for(let t=0;t<this.fruitNode.children.length;t++){const i=this.fruitNode.children[t];if(!i.active)continue;const r=this.getFruitHeight(i);this.allFruitsHeigth[i.uuid]?e[i.uuid]=this.allFruitsHeigth[i.uuid]:e[i.uuid]={history:[],min:r},e[i.uuid].history.push(r),e[i.uuid].history.length>5&&e[i.uuid].history.shift()}this.allFruitsHeigth=e;let i=t;for(const t in e){const r=e[t];if(r.history.length<5)continue;let n=Math.min(...r.history);(n<r.min||n!=r.history[4])&&(r.min=n),i<r.min&&(i=r.min)}this.fruitHeigth=i,z.instance.updateTopHigh(i)}getFruitHeight(t){return t.position.y+t.getComponent(g).height/2}destroyFruit(t){t.removeFromParent(),t.destroy()}initShowTargetFruit(){this._targetFruitLevel=H.get("targetFruitLevel",1)||1,this.targetParent.active=!1,this.targetLayer.active=!1,this.autoShowTargetFruit()}async autoShowTargetFruit(){const t=_.HintTargetFruitTopLevel;if(this._targetFruitLevel>t)return this.targetParent.active=!1,this.targetLayer.active=!1,void(z.instance.isInHintState=!1);z.instance.isInHintState=!0;const e=this._targetFruitLevel,i=_.getFruitInfo(e),r=_.getFruitInfo(e-1),n=this.picAtlas.getSpriteFrame(i.spriteName),a=this.picAtlas.getSpriteFrame(r.spriteName);this.targetLayer.active=!0,C.stopAllByTarget(this.targetLayer),this.targetLayer.setPosition(0,0,0);const o=["fruit1Icon","fruit2Icon"].map((t=>this.targetLayer.getChildByName("content").getChildByName(t).getComponent(y))),s=this.targetLayer.getChildByName("title").getChildByName("targetIcon").getComponent(y),l=this.targetLayer.getChildByName("content").getChildByName("targetFruit").getComponent(y),u=this.targetLayer.getChildByName("desc").getChildByName("descLabel").getComponent(N);if(o.forEach((t=>{t.spriteFrame=a})),s.spriteFrame=n,l.spriteFrame=n,u.string=`叠加${r.name}颗草莓可以合成一个${i.name}`,await I.show(this.targetLayer,{type:"scale",duration:.3}),e!=this._targetFruitLevel)return;if(await T.wait(1e3),e!=this._targetFruitLevel)return;const h=this.targetParent.position;p(this.targetLayer).parallel(p(this.targetLayer).to(.3,{position:h},{easing:"backInOut"}),p(this.targetLayer).to(.3,{scale:c(0,0,1)},{easing:"backIn"})).call((()=>{this.targetParent.active=!0;const t=this.targetParent.getChildByName("targetIcon").getComponent(y);I.change(t.node,{type:"scale",duration:.3,onChange:()=>{t.spriteFrame=n}}),this.targetLayer.active=!1})).start()}checkFinishShowTargetFruit(t){t==this._targetFruitLevel&&(this._targetFruitLevel++,H.set("targetFruitLevel",this._targetFruitLevel),6==this._targetFruitLevel&&(this.difficultNode.active=!0,this.difficultNode.getComponent(l).play(),this.difficultNode.getComponent(l).on(l.EventType.FINISHED,(()=>{this.difficultNode.active=!1}),this),z.instance.addDifficulty=2),this.autoShowTargetFruit())}initShowNewPlayerProp(){this._isNewPlayer=!0,this._isNewPlayer?(z.instance.showNewPlayerProp=0,H.set("isOldPlayer",!0)):z.instance.showNewPlayerProp=5}checkShowNewUserProp(){if(z.instance.showNewPlayerProp>1)return;let t=1,e=()=>{const e=_.GameBeeConfig.propConfig[t];return{title:e.title,type:t,hintContent:e.hintContent,success:e=>{switch(t){case 1:G.GameStatic.usePropToClearScreenFruit();break;case 2:G.GameStatic.usePropToClearLowFruit();break;case 3:G.GameStatic.usePropToChangeTargetFruit();break;case 4:G.GameUIStatic.updateScore(50)}},fail:t=>{}}};0==z.instance.showNewPlayerProp&&this._showWarningLineN>0?(t=3,G.SkillStatic.showSkillHint(e()),z.instance.showNewPlayerProp++):1==z.instance.showNewPlayerProp&&this._showWarningLineN>1&&(t=4,this.RandomPropLayer.showSkillHint(e()),z.instance.showNewPlayerProp++)}playGuanghuanEffect(t){const e=m(this.guanghuan.node);e.setParent(this.effectParent),e.setPosition(t),e.active=!0,e.getComponent(l).play(),e.getComponent(l).on(l.EventType.FINISHED,(()=>{e.destroy()}),this)}usePropToChangeTargetFruit(){let t=this.targetFruit.getComponent(g).contentSize;C.stopAllByTarget(this.targetFruit),this.targetFruit.setScale(0,0),this.targetFruit.getComponent(y).spriteFrame=this.powerBallFrame,this.targetFruit.getComponent(g).setContentSize(t),this.targetFruit.getComponent(k).fruitNumber=_.PowerBallTag,p(this.targetFruit).to(.3,{scale:c(1,1,1)},{easing:"backOut"}).start()}usePropToClearScreenFruit(){const t=this._floorHeight,e=2*(this.fruitHeigth-t)/3+t;for(let t=this.fruitNode.children.length-1;t>=0;t--){let i=this.fruitNode.children[t];if(!i.active)continue;this.getFruitHeight(i)>e&&this.destroyFruit(i)}}usePropToClearLowFruit(){for(let t=this.fruitNode.children.length-1;t>=0;t--){let e=this.fruitNode.children[t];e.active&&(e.getComponent(k).fruitNumber<3&&this.destroyFruit(e))}}usePropToClearOneFruit(){this.isClearState=!0;for(let t=0;t<this.fruitNode.children.length;t++){let e=this.fruitNode.children[t];e.active&&e.getComponent(k).playHaloAnim()}}onBallTouchEnd(){this.isClearState=!1;for(let t=0;t<this.fruitNode.children.length;t++){let e=this.fruitNode.children[t];e.active&&e.getComponent(k).stopHaloAnim()}}async end(t){G.GameUIStatic.timeStop(),z.instance.canRevive()?U.show("RevivePop"):(U.show("OverScorePop"),this.targetfruitNode.active=!0,z.instance.endGame())}update(){const t=this.fruitHeigth;this.lineNode.children[0].position.y-t<200?this.lineNode.children[0].active||(this._showWarningLineN++,this.lineNode.children[0].active=!0,this.checkShowNewUserProp()):this.lineNode.children[0].position.y-this.fruitHeigth>200&&(this.lineNode.children[0].active=!1)}onDestroy(){G.Instance.setGameStatic(null),G.Instance.setSkillStatic(null)}}).prototype,"ConfirmExitLayer",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=e(at.prototype,"RandomPropLayer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lt=e(at.prototype,"GetMaxAwardLayer",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ut=e(at.prototype,"skillLayer",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(at.prototype,"targetLayer",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=e(at.prototype,"targetParent",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gt=e(at.prototype,"gameBg",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(at.prototype,"fruitNode",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(at.prototype,"targetfruitNode",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(at.prototype,"fruitPre",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mt=e(at.prototype,"lineNode",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yt=e(at.prototype,"picAtlas",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ft=e(at.prototype,"powerBallFrame",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wt=e(at.prototype,"floor",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(at.prototype,"guanghuan",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=e(at.prototype,"effectParent",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nt=e(at.prototype,"airdropParent",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pt=e(at.prototype,"difficultNode",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=at))||nt));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/gamePanel', 'chunks:///_virtual/gamePanel'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});