System.register("chunks:///_virtual/drawMergeItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LoadUtil.ts","./NodeUtil.ts"],(function(e){var t,i,r,n,o,a,l,c,s,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){r=e.cclegacy,n=e.Node,o=e.Sprite,a=e.Label,l=e._decorator,c=e.Component},function(e){s=e.default},function(e){u=e.NodeUtil}],execute:function(){var p,b,d,h,g,f,m,w,y,z,I,L,N,v,M;r._RF.push({},"031dayQuf9K85NwU1rqgg6v","drawMergeItem",void 0);const{ccclass:S,property:U}=l;e("drawMergeItem",(p=S("drawMergeItem"),b=U(n),d=U(o),h=U(n),g=U(a),f=U(a),m=U(a),p((z=t((y=class extends c{constructor(){super(...arguments),i(this,"iconNode",z,this),i(this,"prizeIcon",I,this),i(this,"countNode",L,this),i(this,"countLabel",N,this),i(this,"unitLabel",v,this),i(this,"awardLabel",M,this)}setInfo(e){this.awardLabel.string=""+e.n,"basic"==e.moduleType?(this.prizeIcon.node.active=!1,this.countNode.active=!0,this.countLabel.string=""+e.n,this.unitLabel.string="  "+e.unit):(this.prizeIcon.node.active=!0,this.countNode.active=!1,s.getSpriteFrameIntelligent(e.awardIcon,(e=>{this.isValid&&e&&u.limitSpriteSize(this.prizeIcon,e,100,100)})))}}).prototype,"iconNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=t(y.prototype,"prizeIcon",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(y.prototype,"countNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=t(y.prototype,"countLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=t(y.prototype,"unitLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=t(y.prototype,"awardLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=y))||w));r._RF.pop()}}}));

System.register("chunks:///_virtual/drawMergeWindow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CustomScrollViewWithPrefab.ts","./popComponent.ts","./drawMergeItem.ts"],(function(e){var r,t,i,o,a,n,c;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){i=e.cclegacy,o=e._decorator},function(e){a=e.CustomScrollViewWithPrefab},function(e){n=e.popComponent},function(e){c=e.drawMergeItem}],execute:function(){var p,s,l,d,u;i._RF.push({},"b932ctKrt5NiZUgRP5i8cJD","drawMergeWindow",void 0);const{ccclass:w,property:m}=o;e("drawMergeWindow",(p=w("drawMergeWindow"),s=m(a),p((u=r((d=class extends n{constructor(){super(...arguments),t(this,"awardScrollView",u,this)}show(e){this.node.active=!0,this.awardScrollView.setPrefabData(((e,r,t)=>{r.getComponent(c).setInfo(e)})),this.awardScrollView.dateList=e.prizeList.map((e=>({n:e.prize.rewardCount,awardName:e.prize.prizeName,awardIcon:e.prize.prizePicture,moduleType:e.moduleType,unit:e.prize.prizeType})))}}).prototype,"awardScrollView",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=d))||l));i._RF.pop()}}}));

System.register("chunks:///_virtual/drawRule.ts",["./rollupPluginModLoBabelHelpers.js","cc","./popComponent.ts","./LanguageData.ts"],(function(t){var e,n,o,r,i,l,s,a,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.initializerDefineProperty},function(t){o=t.cclegacy,r=t.Label,i=t.Node,l=t._decorator,s=t.instantiate},function(t){a=t.popComponent},function(t){c=t.LanguageData}],execute:function(){var u,p,d,h,g,f,m,b,y;o._RF.push({},"fedd8P5qAtDR4GSaMXmVZis","drawRule",void 0);const{ccclass:w,property:v}=l;t("drawRule",(u=w("drawRule"),p=v(r),d=v(r),h=v(i),u((m=e((f=class extends a{constructor(){super(...arguments),n(this,"title",m,this),n(this,"rule",b,this),n(this,"content",y,this)}onInit(){this.title.node.removeFromParent(),this.rule.node.removeFromParent();let t={};t=c.translate("draw_rule");const e=Object.keys(t);this.content.removeAllChildren();let n=[],o=[];for(let i=0;i<e.length;i++){const l=e[i];if(l.includes("title")){const e=s(this.title.node);n.push(e),e.getComponent(r).string=t[l]}else if(l.includes("content")){const e=s(this.rule.node);if(o.push(e),"content_1"==l){const n="2024.11.25",o="2026.03.31";e.getComponent(r).string=c.translateArgs(t[l],n,o)}else e.getComponent(r).string=t[l]}}for(let t=0;t<n.length;t++)n[t].parent=this.content,o[t].parent=this.content;super.onInit()}}).prototype,"title",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=e(f.prototype,"rule",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=e(f.prototype,"content",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=f))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/PrizeDraw",["./PrizeDraw.ts","./SyntheticContent.ts","./SyntheticWindow.ts","./drawMergeItem.ts","./drawMergeWindow.ts","./drawRule.ts"],(function(){return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PrizeDraw.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameGlobal.ts","./GlobalManager.ts","./panelBasic.ts","./EventUtil.ts","./BundleLayer.ts"],(function(e){var n,t,i,r,a,o,l,s,u,c,h;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){i=e.cclegacy,r=e.Node,a=e.Label,o=e._decorator},function(e){l=e.GameGlobal},function(e){s=e.default},function(e){u=e.default},function(e){c=e.default},function(e){h=e.default}],execute:function(){var p,w,d,f,g,y,b,m,v,S,M,_,z,H,D;i._RF.push({},"ea56aqncZZGqaY+OrLQud+R","PrizeDraw",void 0);const{ccclass:C,property:P}=o;e("PrizeDraw",(p=C("PrizeDraw"),w=P(r),d=P(r),f=P(r),g=P(r),y=P(a),b=P(r),p((S=n((v=class extends u{constructor(){super(...arguments),t(this,"allScrollView",S,this),t(this,"mergeWindow",M,this),t(this,"drawRule",_,this),t(this,"inviteContent",z,this),t(this,"moneyLabel",H,this),t(this,"drawContent",D,this)}get showNode(){return this.main}get serverConfig(){return l.instance.serverConfig}get uiPopupManager(){return s.moduleManager("uiPopupManager")}async onInit(){c.on("inviteHint",this._openHint,this),c.on("openMergeWindow",this._onOpenSyntheticWindow,this),super.onInit()}async onShow(){this.allScrollView.active=!1,this._refreshDrawBtnState(),this._refreshMoney(),s.moduleManager("drawManager").showDraw(this.drawContent),s.moduleManager("inviteManager").showConfigListPanel(this.inviteContent),this.allScrollView.active=!0,await super.onShow()}async onHide(e){super.onHide()}showRule(){this.drawRule.active=!0}openRankBtnHandler(){h.show("Rank")}openShareFriendBtnHandler(){c.emit("openShareStatus")}_openHint(){s.moduleManager("inviteManager").showInviteHint()}_onOpenSyntheticWindow(){this.mergeWindow.active=!0}async _getMoney(){}_refreshMoney(){}_refreshDrawBtnState(){}async destroySelf(e,n,t){c.off("inviteHint",this._openHint,this),c.off("openMergeWindow",this._onOpenSyntheticWindow,this),await super.destroySelf(e,!0,t)}}).prototype,"allScrollView",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=n(v.prototype,"mergeWindow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=n(v.prototype,"drawRule",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=n(v.prototype,"inviteContent",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=n(v.prototype,"moneyLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=n(v.prototype,"drawContent",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=v))||m));i._RF.pop()}}}));

System.register("chunks:///_virtual/SyntheticContent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventUtil.ts","./LoadUtil.ts","./NodeUtil.ts","./GameGlobal.ts","./SyntheticWindow.ts"],(function(t){var e,i,n,o,r,s,a,l,c,h,u,p,d,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,o=t.Node,r=t.Label,s=t.Button,a=t._decorator,l=t.Component,c=t.Sprite},function(t){h=t.default},function(t){u=t.default},function(t){p=t.NodeUtil},function(t){d=t.GameGlobal},function(t){f=t.SyntheticWindow}],execute:function(){var m,y,b,g,C,w,L,S,z,B,P,v;n._RF.push({},"69092L95C1Bu69Qjn1O0fnQ","SyntheticContent",void 0);const{ccclass:_,property:I}=a;t("SyntheticContent",(m=_("SyntheticContent"),y=I(o),b=I(r),g=I(s),C=I(f),m(((v=class t extends l{constructor(){super(...arguments),i(this,"itemContent",S,this),i(this,"syntheticAwardLabel",z,this),i(this,"hintLeftButton",B,this),i(this,"syntheticWindow",P,this)}start(){h.on("drawPrizeInfoChanged",this.setInfo,this),this.setInfo(),p.BtnOnClick(this.hintLeftButton,(()=>{t._canShowHint=!1,this.hintLeftButton.node.active=!1}),this)}setInfo(){const e=d.instance.gameServer.drawPrizeListInfo;if(!e)return;this.syntheticAwardLabel.string=`集齐道具，得${e.composePrize.rewardCount}${e.composePrize.prizeName}`;let i=0,n=null;this.itemContent.children.forEach(((t,o)=>{const s=t.getChildByName("iconSprite").getComponent(c),a=t.getChildByName("nLabel").getComponent(r),l=e.collectPrize[o];l&&(e.composePrize.isCompose||l.sum||(i++,n=t),a.string=l.sum.toString(),u.getSpriteFrameIntelligent(l.prizePicture,(t=>{this.isValid&&t&&(s.spriteFrame=t)})))}));const o=t._canShowHint&&1==i;this.hintLeftButton.node.active=o,o&&this.hintLeftButton.node.setPosition(n.position.x,this.hintLeftButton.node.position.y),e.composePrize.isCompose}update(t){}})._canShowHint=!0,S=e((L=v).prototype,"itemContent",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=e(L.prototype,"syntheticAwardLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=e(L.prototype,"hintLeftButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=e(L.prototype,"syntheticWindow",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=L))||w));n._RF.pop()}}}));

System.register("chunks:///_virtual/SyntheticWindow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./GameGlobal.ts","./popComponent.ts","./LanguageData.ts","./LoadUtil.ts","./drawMergeWindow.ts"],(function(t){var e,i,n,s,o,a,r,c,l,h,g,u,d,p,w,m,f,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,s=t.Button,o=t.Node,a=t.CCInteger,r=t._decorator,c=t.Vec3,l=t.Sprite,h=t.TweenSystem,g=t.tween,u=t.Label},function(t){d=t.NodeUtil},function(t){p=t.GameGlobal},function(t){w=t.popComponent},function(t){m=t.LanguageData},function(t){f=t.default},function(t){y=t.drawMergeWindow}],execute:function(){var b,S,P,x,I,M,z,D,E,A,N,H,R,T,C,B,v,G,L;n._RF.push({},"0e40dv40NtH/o3v8Pb10IEz","SyntheticWindow",void 0);const{ccclass:_,property:O}=r,k={hextech:{outerDelayBase:.2,centerDelay:.8,delayStep:.1,appearDuration:.3,bounceHeight:30,bounceScale:1.2,settleDuration:.2},rotation:{speed:-1,centerIndex:4},centerBlock:{delay:2e3,flashTimes:2,flashDuration:.2,flashScale:1.2}};var W=function(t){return t[t.IDLE=0]="IDLE",t[t.HEXTECH=1]="HEXTECH",t[t.ROTATING=2]="ROTATING",t[t.MERGED=3]="MERGED",t}(W||{});t("SyntheticWindow",(b=_("SyntheticWindow"),S=O(s),P=O(o),x=O(o),I=O(o),M=O(s),z=O(y),D=O(a),E=O(a),b((H=e((N=class extends w{constructor(){super(...arguments),i(this,"okBtn",H,this),i(this,"content",R,this),i(this,"shadowNode",T,this),i(this,"bigIcon",C,this),i(this,"mergeBtn",B,this),i(this,"drawMergeWindow",v,this),i(this,"speed",G,this),i(this,"maxSpeed",L,this),this.config=k,this.state=W.IDLE,this.originalPositions=[],this.originalScales=[],this.rotationAngle=0,this.center=new c,this.radius=0,this.originalAngles=[],this.targetPositions=[],this.targetScale=new c(.45,.45,1),this.layoutScale=new c(1.5,1.5,1),this.isMerging=!1,this.mergeProgress=0,this.mergeDuration=.5,this._isCollected=!0}initializeButton(){}async onInit(){await super.onInit()}async onShow(){this.bigIcon.scale=new c(0,0,0),this.initializeButton(),this._updateUI(),this.startHextechEffect(),await super.onShow()}_updateUI(){let t=p.instance.gameServer.drawPrizeListInfo;if(!t)return;const e=this.mergeBtn.getComponent(l);e.grayscale=!1;let i=t.collectPrize;for(let t=0;t<i.length;t++){const n=this.content.children[t].getComponentInChildren(l);n&&(i[t].sum<1?(n.grayscale=!0,this._isCollected=!1,e.grayscale=!0):n.grayscale=!1,f.getSpriteFrameIntelligent(i[t].prizePicture,(t=>{t&&d.limitSpriteSize(n,t,228,181)})))}const n=this.bigIcon.getComponent(l);f.getSpriteFrameIntelligent(t.composePrize.prizePicture,(t=>{t&&d.limitSpriteSize(n,t,228,181)}))}update(t){this.state==W.ROTATING&&this.updateRotation(t),this.updateMerge(t)}updateRotation(t){this.speed=Math.min(this.speed+t,this.maxSpeed),this.rotationAngle+=this.config.rotation.speed*t*this.speed,this.rotationAngle<=2*-Math.PI&&(this.rotationAngle+=2*Math.PI);this.content.children.forEach(((t,e)=>{e!==this.config.rotation.centerIndex&&this.updateNodePosition(t,e)}))}updateNodePosition(t,e){const i=this.originalAngles[e]+this.rotationAngle,n=this.center.x+this.radius*Math.cos(i),s=this.center.y+this.radius*Math.sin(i);t.position=new c(n,s,t.position.z)}async startHextechEffect(){this.state=W.HEXTECH;const t=this.content.children;0!==t.length&&(this.saveOriginalStates(t),this.initializeNodes(t),await this.playHextechAnimation(t))}saveOriginalStates(t){this.originalPositions=t.map((t=>t.position.clone())),this.originalScales=t.map((t=>t.scale.clone()))}_reset(){this.state=W.IDLE,this.speed=5,this.rotationAngle=0,this.mergeProgress=0,this.isMerging=!1,h.instance.ActionManager.removeAllActionsFromTarget(this.shadowNode),this.shadowNode.scale=new c(0,0,0),this.bigIcon.scale=new c(0,0,0),this.content.scale=new c(1,1,1),this.content.children.map(((t,e)=>t.setPosition(this.originalPositions[e])))}initializeNodes(t){t.forEach((t=>{t.scale=new c(0,0,0)}))}async playHextechAnimation(t){const e=t.map(((t,e)=>this.createHextechTween(t,e)));await Promise.all(e)}createHextechTween(t,e){return new Promise((i=>{const n=this.calculateHextechDelay(e),s=this.config.hextech;g(t).delay(n).to(s.appearDuration,{scale:new c(s.bounceScale,s.bounceScale,1),position:new c(t.position.x,t.position.y+s.bounceHeight,t.position.z)},{easing:"backOut"}).to(s.settleDuration,{scale:this.originalScales[e],position:this.originalPositions[e]},{easing:"sineIn"}).call((()=>i())).start()}))}calculateHextechDelay(t){return t===this.config.rotation.centerIndex?this.config.hextech.centerDelay:this.config.hextech.outerDelayBase+t*this.config.hextech.delayStep}startRotation(){this.state=W.ROTATING;const t=this.content.children;0!==t.length&&(g(this.shadowNode).to(3,{scale:new c(1,1,1)}).start(),this.calculateRotationParameters(t),this.rotationAngle=0)}calculateRotationParameters(t){this.center=this.originalPositions[this.config.rotation.centerIndex].clone(),this.calculateRadius(t),this.calculateOriginalAngles(t)}calculateRadius(t){this.radius=0,t.forEach(((t,e)=>{if(e===this.config.rotation.centerIndex)return;const i=t.position,n=i.x-this.center.x,s=i.y-this.center.y,o=Math.sqrt(n*n+s*s);this.radius=Math.max(this.radius,o)}))}calculateOriginalAngles(t){this.originalAngles=[],t.forEach(((t,e)=>{if(e===this.config.rotation.centerIndex)return;const i=t.position,n=i.x-this.center.x,s=i.y-this.center.y;this.originalAngles[e]=Math.atan2(s,n)}))}mergeHandle(){this.content.children.length<4||(this.targetPositions=[new c(-40,40,0),new c(45,40,0),new c(-40,-30,0),new c(45,-30,0)],h.instance.ActionManager.removeAllActionsFromTarget(this.shadowNode),g(this.shadowNode).to(1.5,{scale:new c(5,5,1)}).call((()=>{this.bigIcon.scale=new c(1,1,1)})).to(.5,{scale:new c(0,0,0)}).start(),this.isMerging=!0,this.mergeProgress=0)}updateMerge(t){if(!this.isMerging)return;this.mergeProgress=Math.min(this.mergeProgress+t/this.mergeDuration,1);this.content.children.slice(0,4).forEach(((t,e)=>{const i=this.originalPositions[e],n=this.targetPositions[e],s=this.easeOutBack(this.mergeProgress),o=new c(i.x+(n.x-i.x)*s,i.y+(n.y-i.y)*s,i.z),a=new c(1+(this.targetScale.x-1)*s,1+(this.targetScale.y-1)*s,1);t.position=o,t.scale=a})),this.content.scale=new c(1+this.layoutScale.x*this.mergeProgress,1+this.layoutScale.y*this.mergeProgress,1),this.mergeProgress>=1&&(this.isMerging=!1,this.state=W.MERGED,this.mergeBtn.getComponentInChildren(u).string=m.translate("draw_merge"))}easeOutBack(t){const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)}async mergeBtnClick(){if(!this._isCollected)return;if(this.state==W.MERGED){const t={token:"",drawNum:-1,todayDrawNum:-1,prizeList:[{moduleType:"basic",prize:(await p.instance.gameServer.drawPrizeListInfo).composePrize}],draw:-1,point:-1};return this.drawMergeWindow.show(t),void this.destroySelf()}this.startRotation();await p.instance.gameServer.composePrize()?this.mergeHandle():this._reset()}}).prototype,"okBtn",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=e(N.prototype,"content",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=e(N.prototype,"shadowNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=e(N.prototype,"bigIcon",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=e(N.prototype,"mergeBtn",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=e(N.prototype,"drawMergeWindow",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=e(N.prototype,"speed",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),L=e(N.prototype,"maxSpeed",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),A=N))||A));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/PrizeDraw', 'chunks:///_virtual/PrizeDraw'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});